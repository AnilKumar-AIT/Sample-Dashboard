{% extends 'base.html' %}
{% block title %}Support ‚Äî FallVision{% endblock %}
{% block page_title %}Support Center{% endblock %}

{% block extra_head %}
<style>
.support-hero{background:linear-gradient(135deg,#1A1916,#2d2722);border-radius:var(--radius-lg);padding:40px;margin-bottom:28px;display:flex;gap:40px;align-items:center;flex-wrap:wrap;position:relative;overflow:hidden}
.support-hero::before{content:'';position:absolute;top:-80px;right:-80px;width:360px;height:360px;border-radius:50%;background:radial-gradient(circle,rgba(212,160,23,.2),transparent 70%)}
.support-hero h2{font-family:var(--font-display);font-size:30px;color:#fff;margin-bottom:10px;letter-spacing:-.3px}
.support-hero p{font-size:15px;color:rgba(255,255,255,.6);line-height:1.7;max-width:480px}
.status-chip{display:inline-flex;align-items:center;gap:8px;background:rgba(45,140,110,.2);border:1px solid rgba(45,140,110,.3);color:#4DD4A0;font-size:13px;font-weight:600;padding:7px 16px;border-radius:999px;margin-top:16px}
.status-dot{width:8px;height:8px;background:#4DD4A0;border-radius:50%;animation:pulse 1.4s infinite}
.channel-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:28px}
.channel-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:28px 24px;text-align:center;transition:.2s;cursor:default}
.channel-card:hover{border-color:var(--yellow);box-shadow:0 4px 20px rgba(212,160,23,.15);transform:translateY(-2px)}
.channel-card.featured{background:var(--yellow-light);border-color:#e8d898}
.ch-icon{width:56px;height:56px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:22px;margin:0 auto 16px}
.ch-title{font-family:var(--font-display);font-size:18px;margin-bottom:6px}
.ch-desc{font-size:13px;color:var(--text2);line-height:1.6;margin-bottom:16px}
.ch-badge{display:inline-block;font-size:12px;font-weight:700;padding:4px 12px;border-radius:999px}
.ticket-form label{display:block;font-size:13px;font-weight:600;color:var(--text2);margin-bottom:7px}
.ticket-form input,.ticket-form select,.ticket-form textarea{width:100%;padding:12px 14px;border-radius:10px;border:1.5px solid var(--border);font-family:var(--font-sans);font-size:14px;color:var(--text);background:var(--surface);outline:none;transition:.15s}
.ticket-form input:focus,.ticket-form select:focus,.ticket-form textarea:focus{border-color:var(--yellow);box-shadow:0 0 0 3px rgba(212,160,23,.12)}
.ticket-form textarea{resize:vertical;min-height:110px}
.form-row-2{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}
.fmg{margin-bottom:16px}
.file-drop{border:2px dashed var(--border);border-radius:10px;padding:24px;text-align:center;color:var(--text3);font-size:14px;cursor:pointer;transition:.2s}
.file-drop:hover{border-color:var(--yellow);background:var(--yellow-light)}
.file-drop i{font-size:24px;margin-bottom:8px;display:block}
.agent-card{display:flex;gap:14px;align-items:flex-start;padding:16px;border:1px solid var(--border);border-radius:var(--radius);margin-bottom:10px;background:var(--surface)}
.agent-av{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:15px;flex-shrink:0;position:relative}
.online-dot{position:absolute;bottom:1px;right:1px;width:11px;height:11px;background:var(--green);border-radius:50%;border:2px solid #fff}
.agent-name{font-weight:700;font-size:14px}
.agent-role{font-size:12px;color:var(--text3)}
.agent-spec{font-size:12px;color:var(--text2);margin-top:4px}
.agent-wait{font-size:12px;color:var(--green);font-weight:600;margin-top:4px}
.kb-card{display:flex;gap:14px;padding:14px;border:1px solid var(--border);border-radius:var(--radius);background:var(--surface);text-decoration:none;color:var(--text);transition:.15s;margin-bottom:8px}
.kb-card:hover{border-color:var(--yellow);background:var(--yellow-light)}
.kb-icon{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
.sys-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--border);font-size:14px}
.sys-row:last-child{border-bottom:none}
</style>
{% endblock %}

{% block content %}
<div class="support-hero">
  <div style="flex:1;position:relative;z-index:1">
    <h2>We're here to help, 24 hours a day.</h2>
    <p>Technical questions, clinical data interpretation, urgent patient safety concerns ‚Äî our specialist team is always reachable.</p>
    <div class="status-chip"><div class="status-dot"></div>All systems operational ¬∑ 43 agents online right now</div>
  </div>
  <div style="display:flex;flex-direction:column;gap:10px;flex-shrink:0;position:relative;z-index:1">
    {% for n, lbl in [('&lt;2 min','Avg chat response'),('&lt;4 hrs','Email response SLA'),('98.9%','Customer satisfaction'),('24/7','Support availability')] %}
    <div style="background:rgba(255,255,255,.06);border-radius:12px;padding:12px 18px;border:1px solid rgba(255,255,255,.08);display:flex;gap:14px;align-items:center">
      <div style="font-family:var(--font-display);font-size:20px;color:#4DD4A0">{{ n }}</div>
      <div style="font-size:12px;color:rgba(255,255,255,.5)">{{ lbl }}</div>
    </div>
    {% endfor %}
  </div>
</div>

<div class="channel-grid">
  <div class="channel-card featured">
    <div class="ch-icon" style="background:var(--yellow);color:#000"><i class="fa-solid fa-comments"></i></div>
    <div class="ch-title">Live Chat</div>
    <div class="ch-desc">Connect instantly with a support specialist. Average wait time is under 2 minutes during business hours.</div>
    <div class="ch-badge" style="background:var(--green-light);color:var(--green)">üü¢ 43 agents online</div>
    <button class="btn btn-primary" style="justify-content:center;margin-top:14px;width:100%" onclick="openChat()"><i class="fa-solid fa-comment-dots"></i> Start Chat Now</button>
  </div>
  <div class="channel-card">
    <div class="ch-icon" style="background:var(--blue-light);color:var(--blue)"><i class="fa-solid fa-ticket"></i></div>
    <div class="ch-title">Submit a Ticket</div>
    <div class="ch-desc">For non-urgent issues, detailed technical problems, or requests that require investigation by our engineering team.</div>
    <div class="ch-badge" style="background:var(--blue-light);color:var(--blue)">‚è± Response within 4 hours</div>
    <button class="btn btn-outline" style="justify-content:center;margin-top:14px;width:100%" onclick="document.getElementById('ticketSection').scrollIntoView({behavior:'smooth'})"><i class="fa-solid fa-pen-to-square"></i> Open a Ticket</button>
  </div>
  <div class="channel-card">
    <div class="ch-icon" style="background:var(--green-light);color:var(--green)"><i class="fa-solid fa-phone"></i></div>
    <div class="ch-title">Phone Support</div>
    <div class="ch-desc">Speak directly with a senior healthcare support specialist. Available for Clinical plan subscribers and urgent patient safety concerns.</div>
    <div class="ch-badge" style="background:var(--green-light);color:var(--green)">üìû +91 80 4785 2200</div>
    <button class="btn btn-outline" style="justify-content:center;margin-top:14px;width:100%"><i class="fa-solid fa-calendar-check"></i> Schedule a Call</button>
  </div>
</div>

<div class="grid-65-35">
  <div id="ticketSection" class="card">
    <div class="card-header">
      <div>
        <div class="card-title">Submit a Support Ticket</div>
        <div class="card-subtitle">Describe your issue in detail ‚Äî a specialist will respond within 4 hours</div>
      </div>
      <span class="badge badge-green"><i class="fa-solid fa-clock"></i> &lt;4h SLA</span>
    </div>
    <form class="ticket-form" onsubmit="submitTicket(event)" id="ticketForm">
      <div class="form-row-2">
        <div><label>Your Name</label><input type="text" value="{{ user.name }}" readonly style="background:var(--surface2)"/></div>
        <div><label>Email Address</label><input type="email" value="{{ user.email }}" readonly style="background:var(--surface2)"/></div>
      </div>
      <div class="form-row-2">
        <div><label>Issue Category</label><select><option>Data & Monitoring</option><option>Emergency Hub / Alerts</option><option>Brain-Movement Interpretation</option><option>Device & Connectivity</option><option>Privacy & Account Security</option><option>Billing & Subscriptions</option><option>Clinical / Medical Question</option><option>Bug Report</option><option>Feature Request</option><option>Urgent Patient Safety Concern</option></select></div>
        <div><label>Priority Level</label><select><option>Low ‚Äî General question</option><option>Medium ‚Äî Affects my monitoring</option><option>High ‚Äî Urgent / Patient safety</option></select></div>
      </div>
      <div class="fmg"><label>Subject</label><input type="text" placeholder="e.g. Dashboard not showing today's data correctly"/></div>
      <div class="fmg"><label>Describe Your Issue</label><textarea placeholder="Please describe the problem in as much detail as possible. Include what you were doing when the issue occurred, what you expected to happen, and what actually happened."></textarea></div>
      <div class="fmg"><label>Affected Dashboard Section</label><select><option value="">‚Äî Select if applicable ‚Äî</option><option>Dashboard Overview</option><option>Detection Page</option><option>Past Records</option><option>Emergency Hub</option><option>Trends</option><option>Account / Settings</option><option>Mobile App</option></select></div>
      <div class="fmg">
        <label>Attachments (optional)</label>
        <div class="file-drop" onclick="this.querySelector('input').click()">
          <i class="fa-solid fa-cloud-arrow-up"></i>
          Drag & drop screenshots or files here, or click to browse
          <div style="font-size:12px;margin-top:6px;color:var(--text3)">PNG, JPG, PDF up to 10MB each</div>
          <input type="file" multiple accept=".png,.jpg,.pdf" style="display:none"/>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:16px;margin-top:8px">
        <button type="submit" class="btn btn-primary" style="flex:1;justify-content:center"><i class="fa-solid fa-paper-plane"></i> Submit Support Ticket</button>
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text2);cursor:pointer;white-space:nowrap"><input type="checkbox" checked/> Email me updates</label>
      </div>
    </form>
    <div id="ticketSuccess" style="display:none;text-align:center;padding:40px">
      <div style="font-size:48px;margin-bottom:16px">‚úÖ</div>
      <div style="font-family:var(--font-display);font-size:22px;margin-bottom:8px">Ticket Submitted!</div>
      <div style="color:var(--text2);font-size:14px;line-height:1.7;max-width:380px;margin:0 auto 20px">Your ticket <strong id="ticketId"></strong> has been received. A specialist will respond to <strong>{{ user.email }}</strong> within 4 hours.</div>
      <button class="btn btn-outline" onclick="resetTicket()"><i class="fa-solid fa-plus"></i> Submit Another Ticket</button>
    </div>
  </div>

  <div style="display:flex;flex-direction:column;gap:16px">
    <div class="card">
      <div class="card-title" style="margin-bottom:14px">üü¢ Available Specialists</div>
      {% for name, role, init, spec, wait, color in [('Dr. Ananya Mehta','Clinical Support Lead','AM','Geriatric medicine ¬∑ Fall prevention','~1 min wait','#7C3AED'),('Rohan Krishnan','Technical Support','RK','Device connectivity ¬∑ Dashboard issues','~2 min wait','#2563EB'),('Priya Sundar','Healthcare Advisor','PS','Data interpretation ¬∑ Care planning','~3 min wait','#059669'),('Siddharth Rao','Billing & Accounts','SR','Subscriptions ¬∑ Plan upgrades','~1 min wait','#D97706')] %}
      <div class="agent-card">
        <div class="agent-av" style="background:{{ color }}">{{ init }}<div class="online-dot"></div></div>
        <div style="flex:1">
          <div class="agent-name">{{ name }}</div>
          <div class="agent-role">{{ role }}</div>
          <div class="agent-spec">{{ spec }}</div>
          <div class="agent-wait">{{ wait }}</div>
        </div>
        <button class="btn btn-outline btn-sm" onclick="openChat()"><i class="fa-solid fa-comment"></i> Chat</button>
      </div>
      {% endfor %}
    </div>

    <div class="card">
      <div class="card-title" style="margin-bottom:14px"><i class="fa-solid fa-server" style="color:var(--green)"></i> System Status</div>
      {% for component, ok in [('Dashboard & Analytics',True),('Live Monitoring API',True),('Emergency Alert System',True),('FallVision Band Sync',True),('Email Notifications',True),('Data Export Service',False)] %}
      <div class="sys-row">
        <span style="font-size:13px">{{ component }}</span>
        <div style="display:flex;align-items:center;gap:6px;font-size:13px;font-weight:600;color:{% if ok %}var(--green){% else %}var(--yellow-dark){% endif %}">
          <span style="width:8px;height:8px;border-radius:50%;background:{% if ok %}var(--green){% else %}var(--yellow-mid){% endif %};display:inline-block"></span>
          {% if ok %}Operational{% else %}Degraded{% endif %}
        </div>
      </div>
      {% endfor %}
      <div style="margin-top:12px;font-size:12px;color:var(--text3)">Last updated 4 minutes ago</div>
    </div>

    <div class="card">
      <div class="card-title" style="margin-bottom:14px">üìö Popular Help Articles</div>
      {% for title, icon in [('Setting up your Emergency Contact list','fa-address-book'),('Understanding your Fall Risk Score','fa-triangle-exclamation'),('Exporting health data as CSV or PDF','fa-file-export'),('Pairing the FallVision Band Pro','fa-bluetooth'),('Reading brain-movement correlation charts','fa-brain')] %}
      <a href="/faq" class="kb-card">
        <div class="kb-icon" style="background:var(--yellow-light);color:var(--yellow-dark)"><i class="fa-solid {{ icon }}"></i></div>
        <div style="flex:1"><div style="font-weight:600;font-size:13px">{{ title }}</div></div>
        <div style="color:var(--text3);align-self:center"><i class="fa-solid fa-chevron-right"></i></div>
      </a>
      {% endfor %}
      <a href="/faq" class="btn btn-outline btn-sm" style="width:100%;justify-content:center;margin-top:6px"><i class="fa-solid fa-book-open"></i> Browse All Help Articles</a>
    </div>
  </div>
</div>

<!-- Live chat widget -->
<div id="chatWidget" style="display:none;position:fixed;bottom:24px;right:24px;width:360px;height:480px;background:var(--surface);border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.18);border:1px solid var(--border);z-index:1000;flex-direction:column;overflow:hidden">
  <div style="background:linear-gradient(135deg,#1A1916,#2d2722);padding:16px 20px;display:flex;align-items:center;justify-content:space-between">
    <div style="display:flex;align-items:center;gap:10px">
      <div style="width:36px;height:36px;border-radius:50%;background:var(--yellow);display:flex;align-items:center;justify-content:center;font-weight:700;color:#000">FV</div>
      <div>
        <div style="font-weight:600;font-size:14px;color:#fff">FallVision Support</div>
        <div style="font-size:12px;color:rgba(255,255,255,.5)">üü¢ Dr. Ananya online</div>
      </div>
    </div>
    <button onclick="closeChat()" style="background:none;border:none;color:rgba(255,255,255,.6);cursor:pointer;font-size:16px"><i class="fa-solid fa-xmark"></i></button>
  </div>
  <div id="chatMessages" style="flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;height:348px">
    <div style="max-width:82%;background:var(--surface2);border-radius:14px 14px 14px 4px;padding:12px 14px;font-size:14px;line-height:1.55">Hi {{ user.name.split()[0] }}! üëã I'm Dr. Ananya. How can I help you today? I can assist with clinical questions, data interpretation, or any technical issues with your dashboard.</div>
  </div>
  <div style="padding:12px;border-top:1px solid var(--border);display:flex;gap:8px">
    <input id="chatInput" type="text" placeholder="Type a message‚Ä¶" style="flex:1;padding:10px 14px;border-radius:10px;border:1.5px solid var(--border);font-family:var(--font-sans);font-size:14px;outline:none" onkeydown="if(event.key==='Enter')sendChat()"/>
    <button onclick="sendChat()" class="btn btn-primary btn-sm" style="padding:10px 14px"><i class="fa-solid fa-paper-plane"></i></button>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let tc=1000;
function submitTicket(e){
  e.preventDefault();
  document.getElementById('ticketForm').style.display='none';
  document.getElementById('ticketSuccess').style.display='block';
  document.getElementById('ticketId').textContent='#FV-'+(++tc);
}
function resetTicket(){
  document.getElementById('ticketForm').style.display='block';
  document.getElementById('ticketSuccess').style.display='none';
}
function openChat(){
  const w=document.getElementById('chatWidget');
  w.style.display='flex';w.style.flexDirection='column';
  setTimeout(()=>document.getElementById('chatInput').focus(),100);
}
function closeChat(){document.getElementById('chatWidget').style.display='none'}
const replies=["I'm checking your account details right now. Could you tell me more about when this started?","Based on what you've described it sounds like a device sync issue ‚Äî let me walk you through the fix.","I can see your recent health data on my end. Your Fall Risk Score looks normal. Let me dig deeper.","I'll escalate this to our technical team. You'll hear back within the hour. Anything else I can help with?","Thank you for the detail ‚Äî that's very helpful. I'm running a diagnostic check on your account now."];
let ri=0;
function sendChat(){
  const inp=document.getElementById('chatInput');
  const msg=inp.value.trim();if(!msg)return;
  const msgs=document.getElementById('chatMessages');
  const ub=document.createElement('div');
  ub.style.cssText='align-self:flex-end;max-width:82%;background:var(--yellow-light);border-radius:14px 14px 4px 14px;padding:12px 14px;font-size:14px;border:1px solid #e8d898';
  ub.textContent=msg;msgs.appendChild(ub);inp.value='';msgs.scrollTop=msgs.scrollHeight;
  setTimeout(()=>{
    const ab=document.createElement('div');
    ab.style.cssText='max-width:82%;background:var(--surface2);border-radius:14px 14px 14px 4px;padding:12px 14px;font-size:14px;line-height:1.55';
    ab.textContent=replies[ri++%replies.length];msgs.appendChild(ab);msgs.scrollTop=msgs.scrollHeight;
  },1200);
}
</script>
{% endblock %}
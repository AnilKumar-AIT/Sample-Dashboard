<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FallVision</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
<script src="https://unpkg.com/feather-icons"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --teal: #2A9D8F;
  --teal-dark: #1d7a6e;
  --teal-light: #E0F2F1;
  --teal-mid: #b2dfdb;
  --red: #e74c3c;
  --amber: #f39c12;
  --bg: #f0f7f6;
  --white: #ffffff;
  --text: #1a2e2c;
  --text-light: #607d79;
  --border: #d0e8e5;
  --shadow: 0 2px 12px rgba(42,157,143,0.10);
  --shadow-lg: 0 8px 32px rgba(42,157,143,0.15);
  --radius: 12px;
  --font: 'DM Sans', sans-serif;
  --font-serif: 'DM Serif Display', serif;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: var(--font); background: var(--bg); color: var(--text); }

/* ===================== PAGES ===================== */
.page { display: none !important; }
.page.active { display: block !important; }
#login.active { display: flex !important; min-height: 100vh; }
#dashboard.active { display: flex !important; }

/* ===================== LANDING ===================== */
#landing { min-height: 100vh; background: var(--white); }
.land-nav {
  display: flex; align-items: center; justify-content: space-between;
  padding: 20px 60px; background: var(--white);
  border-bottom: 1px solid var(--border); position: sticky; top:0; z-index:100;
}
.land-logo { font-family: var(--font-serif); font-size: 1.6rem; color: var(--teal); display:flex; align-items:center; gap:10px; }
.land-nav-links { display: flex; gap: 30px; align-items: center; }
.land-nav-links a { text-decoration: none; color: var(--text-light); font-weight: 500; transition: color .2s; }
.land-nav-links a:hover { color: var(--teal); }
.btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 22px; border-radius: 50px; font-family: var(--font); font-size: 0.95rem; font-weight: 600; cursor: pointer; border: none; text-decoration: none; transition: all .2s; }
.btn-primary { background: var(--teal); color: #fff; }
.btn-primary:hover { background: var(--teal-dark); transform: translateY(-1px); box-shadow: 0 4px 16px rgba(42,157,143,0.3); }
.btn-outline-teal { background: transparent; border: 2px solid var(--teal); color: var(--teal); }
.btn-outline-teal:hover { background: var(--teal); color: #fff; }
.btn-ghost { background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.5); color: #fff; }
.btn-ghost:hover { background: rgba(255,255,255,0.35); }

.hero {
  background: linear-gradient(135deg, #1a2e2c 0%, #2A9D8F 60%, #48b9ab 100%);
  min-height: 520px; display: flex; align-items: center; padding: 80px 60px;
  position: relative; overflow: hidden;
}
.hero::before {
  content: ''; position: absolute; right: -100px; top: -100px;
  width: 500px; height: 500px; border-radius: 50%;
  background: rgba(255,255,255,0.05);
}
.hero::after {
  content: ''; position: absolute; right: 100px; bottom: -150px;
  width: 300px; height: 300px; border-radius: 50%;
  background: rgba(255,255,255,0.04);
}
.hero-content { max-width: 600px; z-index:1; }
.hero-badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.15); color: rgba(255,255,255,0.9); padding: 6px 14px; border-radius: 50px; font-size: 0.8rem; font-weight: 600; margin-bottom: 20px; letter-spacing: 0.05em; }
.hero h1 { font-family: var(--font-serif); font-size: 3rem; color: #fff; line-height: 1.2; margin-bottom: 20px; }
.hero p { color: rgba(255,255,255,0.8); font-size: 1.1rem; line-height: 1.7; margin-bottom: 35px; }
.hero-btns { display: flex; gap: 14px; flex-wrap: wrap; }
.hero-stats { display: flex; gap: 40px; margin-top: 50px; }
.hero-stat { color: rgba(255,255,255,0.9); }
.hero-stat strong { display: block; font-size: 2rem; font-family: var(--font-serif); }
.hero-stat span { font-size: 0.85rem; opacity: 0.7; }

.features-section { padding: 80px 60px; background: var(--white); }
.section-label { text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.75rem; font-weight: 700; color: var(--teal); margin-bottom: 10px; }
.section-title { font-family: var(--font-serif); font-size: 2.2rem; color: var(--text); margin-bottom: 50px; }
.feature-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 25px; }
.feature-card { padding: 30px; background: var(--bg); border-radius: var(--radius); border: 1px solid var(--border); transition: box-shadow .2s, transform .2s; }
.feature-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-3px); }
.feat-icon { width: 52px; height: 52px; background: var(--teal-light); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--teal); margin-bottom: 18px; }
.feature-card h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; }
.feature-card p { color: var(--text-light); line-height: 1.6; font-size: 0.95rem; }

.testimonials-section { padding: 80px 60px; background: var(--bg); }
.testimonial-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 25px; margin-top: 40px; }
.testimonial-card { background: var(--white); border-radius: var(--radius); padding: 28px; border: 1px solid var(--border); box-shadow: var(--shadow); }
.testi-avatar { width: 52px; height: 52px; border-radius: 50%; background: var(--teal-mid); display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--teal-dark); font-size: 1.2rem; margin-bottom: 15px; }
.testi-stars { color: #f39c12; margin-bottom: 12px; font-size: 0.85rem; }
.testimonial-card p { color: var(--text-light); line-height: 1.7; font-size: 0.95rem; margin-bottom: 15px; }
.testi-name { font-weight: 700; font-size: 0.9rem; }
.testi-role { font-size: 0.8rem; color: var(--text-light); }

.land-footer { background: var(--text); color: rgba(255,255,255,0.6); text-align: center; padding: 30px; font-size: 0.85rem; }
.land-footer span { color: var(--teal); font-weight: 600; }

/* ===================== LOGIN ===================== */
#login { min-height: 100vh; display: flex; }
.login-left { flex: 1; display: flex; align-items: center; justify-content: center; background: var(--white); padding: 60px; }
.login-form-wrap { width: 100%; max-width: 400px; }
.login-logo { font-family: var(--font-serif); font-size: 1.8rem; color: var(--teal); margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
.login-subtitle { color: var(--text-light); margin-bottom: 35px; }
.tab-row { display: flex; gap: 5px; background: var(--bg); border-radius: 8px; padding: 4px; margin-bottom: 30px; }
.tab-btn { flex: 1; padding: 9px; border: none; background: none; border-radius: 6px; font-family: var(--font); font-weight: 600; cursor: pointer; color: var(--text-light); transition: all .2s; }
.tab-btn.active { background: var(--white); color: var(--teal); box-shadow: 0 1px 6px rgba(0,0,0,0.08); }
.form-field { margin-bottom: 16px; }
.form-field label { display: block; font-size: 0.85rem; font-weight: 600; color: var(--text); margin-bottom: 6px; }
.form-field input { width: 100%; padding: 12px 14px; border: 1.5px solid var(--border); border-radius: 8px; font-family: var(--font); font-size: 0.95rem; outline: none; transition: border .2s; background: var(--bg); }
.form-field input:focus { border-color: var(--teal); background: var(--white); }
.login-footer-row { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; }
.login-footer-row a { color: var(--teal); font-size: 0.85rem; text-decoration: none; }
.secure-line { display: flex; align-items: center; gap: 6px; color: var(--text-light); font-size: 0.8rem; margin-top: 22px; justify-content: center; }
.login-right { flex: 1; background: linear-gradient(160deg, #1a2e2c, #2A9D8F); display: flex; align-items: flex-end; padding: 60px; position: relative; overflow: hidden; }
.login-right::before { content:''; position:absolute; top:-80px; right:-80px; width:350px; height:350px; border-radius:50%; background:rgba(255,255,255,0.05); }
.login-right-content h2 { font-family: var(--font-serif); font-size: 2.2rem; color: #fff; line-height: 1.3; margin-bottom: 15px; }
.login-right-content p { color: rgba(255,255,255,0.7); font-size: 0.95rem; line-height: 1.7; }

/* signup fields hidden by default */
#signup-fields { display: none; }

/* ===================== DASHBOARD ===================== */
#dashboard { display: none; min-height: 100vh; background: var(--bg); }
#dashboard.active { display: flex; }
.sidebar { width: 240px; background: var(--teal-light); display: flex; flex-direction: column; padding: 25px 18px; border-right: 1px solid var(--teal-mid); flex-shrink: 0; }
.sb-logo { font-family: var(--font-serif); font-size: 1.3rem; color: var(--teal-dark); display: flex; align-items: center; gap: 8px; margin-bottom: 35px; padding-bottom: 20px; border-bottom: 1px solid var(--teal-mid); }
.sb-section-label { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-light); margin-bottom: 8px; margin-top: 20px; }
.sb-nav { display: flex; flex-direction: column; gap: 4px; }
.sb-link { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; text-decoration: none; color: var(--text-light); font-weight: 500; font-size: 0.92rem; transition: all .2s; cursor: pointer; border: none; background: none; font-family: var(--font); width: 100%; }
.sb-link:hover { background: var(--teal-mid); color: var(--teal-dark); }
.sb-link.active { background: var(--teal); color: #fff; }
.sb-link svg { width: 16px; height: 16px; flex-shrink: 0; }
.sb-user { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--teal-mid); display: flex; align-items: center; gap: 10px; }
.sb-avatar { width: 38px; height: 38px; border-radius: 50%; background: var(--teal); display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; font-size: 0.9rem; flex-shrink: 0; }
.sb-user-info { flex: 1; min-width: 0; }
.sb-user-info strong { display: block; font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sb-user-info small { font-size: 0.75rem; color: var(--text-light); }

.dash-main { flex: 1; display: flex; flex-direction: column; min-width: 0; }
.dash-topbar { background: var(--white); border-bottom: 1px solid var(--border); padding: 0 35px; display: flex; align-items: center; justify-content: space-between; height: 64px; gap: 20px; flex-shrink: 0; }
.topbar-title { font-family: var(--font-serif); font-size: 1.2rem; color: var(--text); }
.topbar-nav { display: flex; gap: 4px; }
.topbar-link { display: flex; align-items: center; gap: 6px; padding: 7px 14px; border-radius: 6px; text-decoration: none; color: var(--text-light); font-weight: 500; font-size: 0.88rem; cursor: pointer; border: none; background: none; font-family: var(--font); transition: all .2s; }
.topbar-link:hover { background: var(--bg); color: var(--text); }
.topbar-link.active { background: var(--teal-light); color: var(--teal-dark); font-weight: 600; }
.topbar-right { display: flex; align-items: center; gap: 12px; }
.topbar-badge { background: var(--teal-light); color: var(--teal-dark); padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 5px; }
.topbar-badge .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--teal); animation: pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.4;} }

.dash-content { flex: 1; padding: 30px 35px; overflow-y: auto; }
.dash-view { display: none; }
.dash-view.active { display: block; }

/* Cards */
.card { background: var(--white); border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); padding: 22px; }
.card-title { font-weight: 700; font-size: 0.95rem; color: var(--text); margin-bottom: 4px; }
.card-subtitle { font-size: 0.82rem; color: var(--text-light); }

/* Stats row */
.stats-row { display: grid; grid-template-columns: repeat(4,1fr); gap: 18px; margin-bottom: 25px; }
.stat-item { background: var(--white); border-radius: var(--radius); border: 1px solid var(--border); padding: 20px; }
.stat-item .value { font-size: 2rem; font-family: var(--font-serif); font-weight: 400; color: var(--text); margin: 8px 0 4px; }
.stat-item .label { font-size: 0.8rem; color: var(--text-light); }
.stat-item .change { font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 3px; }
.change.up { color: var(--teal); }
.change.down { color: var(--red); }
.change.neutral { color: var(--amber); }

/* ===================== HOME VIEW ===================== */
.home-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
.home-welcome { background: linear-gradient(135deg, var(--teal), var(--teal-dark)); border-radius: var(--radius); padding: 30px; color: #fff; margin-bottom: 20px; }
.home-welcome h2 { font-family: var(--font-serif); font-size: 1.7rem; margin-bottom: 8px; }
.home-welcome p { opacity: 0.8; font-size: 0.95rem; line-height: 1.6; }
.overview-cards { display: flex; flex-direction: column; gap: 15px; }
.mini-card { background: var(--white); border-radius: var(--radius); border: 1px solid var(--border); padding: 16px 18px; display: flex; align-items: center; gap: 14px; }
.mini-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.mini-icon.green { background: #e0f7f4; color: var(--teal); }
.mini-icon.red { background: #fdecea; color: var(--red); }
.mini-icon.amber { background: #fef9e7; color: var(--amber); }
.mini-card-label { font-size: 0.8rem; color: var(--text-light); }
.mini-card-val { font-weight: 700; font-size: 1.05rem; }
.brain-diagram { background: var(--white); border-radius: var(--radius); border: 1px solid var(--border); padding: 25px; margin-top: 0; }
.diagram-row { display: flex; align-items: center; justify-content: space-around; padding: 25px 10px; }
.diag-node { text-align: center; }
.diag-icon { width: 64px; height: 64px; border-radius: 16px; background: var(--teal-light); display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; color: var(--teal); }
.diag-label { font-size: 0.8rem; font-weight: 600; color: var(--text); }
.diag-sub { font-size: 0.72rem; color: var(--text-light); }
.diag-arrow { color: var(--teal-mid); font-size: 1.5rem; }
.diag-note { text-align: center; background: var(--teal-light); border-radius: 8px; padding: 10px 20px; color: var(--teal-dark); font-size: 0.85rem; font-weight: 600; margin-top: 10px; }

/* ===================== DETECTION VIEW ===================== */
.det-row { display: flex; gap: 22px; }
.det-left { flex: 2; display: flex; flex-direction: column; gap: 16px; }
.det-right { flex: 1; display: flex; flex-direction: column; gap: 16px; }
.video-wrap { background: #111; border-radius: var(--radius); overflow: hidden; position: relative; aspect-ratio: 4/3; }
.video-wrap img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(80%); }
.video-overlay { position: absolute; inset: 0; pointer-events: none; }
.vid-badge { position: absolute; top: 14px; left: 14px; background: rgba(0,0,0,0.6); color: #fff; padding: 6px 14px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 6px; }
.vid-badge .live-dot { width: 7px; height: 7px; background: #e74c3c; border-radius: 50%; animation: pulse 1s infinite; }
.vid-angle { position: absolute; bottom: 16px; left: 16px; background: rgba(255,255,255,0.92); border-radius: 10px; padding: 10px 18px; }
.vid-angle .big { font-size: 2.2rem; font-family: var(--font-serif); color: var(--text); font-weight: 400; }
.vid-angle small { display: block; font-size: 0.78rem; color: var(--text-light); }
.vid-status { position: absolute; top: 14px; right: 14px; background: rgba(42,157,143,0.9); color: #fff; padding: 6px 12px; border-radius: 20px; font-size: 0.78rem; font-weight: 600; display: flex; align-items: center; gap: 5px; }

.limb-selector { display: flex; gap: 8px; }
.limb-btn { flex: 1; padding: 10px; border: 2px solid var(--border); border-radius: 8px; background: var(--white); font-family: var(--font); font-weight: 600; font-size: 0.88rem; cursor: pointer; color: var(--text-light); transition: all .2s; display: flex; align-items: center; justify-content: center; gap: 6px; }
.limb-btn:hover { border-color: var(--teal); color: var(--teal); background: var(--teal-light); }
.limb-btn.active { border-color: var(--teal); background: var(--teal); color: #fff; }

.quality-ring { width: 100px; height: 100px; margin: 0 auto 10px; position: relative; }
.quality-ring svg { width: 100%; height: 100%; transform: rotate(-90deg); }
.quality-ring .ring-bg { fill: none; stroke: var(--teal-light); stroke-width: 8; }
.quality-ring .ring-val { fill: none; stroke: var(--teal); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 283; stroke-dashoffset: 23; transition: stroke-dashoffset .5s; }
.ring-label { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; font-weight: 700; color: var(--teal); font-family: var(--font-serif); }

.threshold-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 0.88rem; }
.threshold-row:last-child { border-bottom: none; }
.toggle { width: 38px; height: 20px; border-radius: 10px; background: var(--teal); position: relative; cursor: pointer; }
.toggle::after { content:''; position:absolute; width:14px; height:14px; background:#fff; border-radius:50%; top:3px; left:3px; transition:left .2s; }
.toggle.off { background: #ddd; }
.toggle.off::after { left:21px; }

/* ===================== RECORDS VIEW ===================== */
.records-header-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.filter-tabs { display: flex; gap: 5px; background: var(--white); border-radius: 8px; padding: 4px; border: 1px solid var(--border); }
.ftab { padding: 7px 14px; border-radius: 6px; border: none; background: none; font-family: var(--font); font-weight: 500; font-size: 0.85rem; cursor: pointer; color: var(--text-light); transition: all .2s; }
.ftab.active { background: var(--teal); color: #fff; }
.date-input { padding: 8px 14px; border: 1.5px solid var(--border); border-radius: 8px; font-family: var(--font); font-size: 0.88rem; outline: none; background: var(--white); }
.date-input:focus { border-color: var(--teal); }

.records-table { width: 100%; border-collapse: collapse; background: var(--white); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border); margin-bottom: 22px; }
.records-table th { background: var(--teal-light); color: var(--teal-dark); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.06em; font-weight: 700; padding: 14px 18px; text-align: left; }
.records-table td { padding: 14px 18px; font-size: 0.88rem; border-bottom: 1px solid var(--border); }
.records-table tr:last-child td { border-bottom: none; }
.records-table tr:hover td { background: var(--bg); }
.badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; }
.badge-green { background: #e0f7f4; color: #1d7a6e; }
.badge-red { background: #fdecea; color: #c0392b; }
.badge-amber { background: #fef9e7; color: #b7770d; }
.badge-blue { background: #e8f4fd; color: #1a6fa8; }

.records-footer-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
.info-card { background: var(--white); border-radius: var(--radius); border: 1px solid var(--border); padding: 20px; }
.info-card h4 { font-size: 0.9rem; font-weight: 700; margin-bottom: 8px; color: var(--text); }
.info-card p { font-size: 0.85rem; color: var(--text-light); line-height: 1.6; }
.event-item { display: flex; gap: 12px; align-items: flex-start; padding: 8px 0; border-bottom: 1px solid var(--border); }
.event-item:last-child { border-bottom: none; }
.event-dot { width: 8px; height: 8px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }

/* ===================== TRENDS VIEW ===================== */
.trends-controls { display: flex; align-items: center; justify-content: space-between; margin-bottom: 22px; }
.time-selector { display: flex; gap: 4px; background: var(--white); border-radius: 8px; padding: 4px; border: 1px solid var(--border); }
.time-btn { padding: 6px 16px; border-radius: 6px; border: none; background: none; font-family: var(--font); font-weight: 600; font-size: 0.85rem; cursor: pointer; color: var(--text-light); transition: all .2s; }
.time-btn.active { background: var(--teal); color: #fff; }

.trends-main-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
.trends-bottom-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 20px; }
.big-metric { font-family: var(--font-serif); font-size: 3rem; color: var(--teal); }
.big-metric.warn { color: var(--amber); }
.metric-change { font-size: 0.82rem; color: var(--text-light); margin-top: 4px; }
.metric-label { font-size: 0.8rem; font-weight: 700; color: var(--text); margin-bottom: 4px; }

/* ===================== EMERGENCY VIEW ===================== */
.emergency-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.status-indicator { display: flex; align-items: center; gap: 10px; margin: 15px 0; }
.status-dot { width: 14px; height: 14px; border-radius: 50%; flex-shrink: 0; animation: pulse 2s infinite; }
.status-dot.online { background: #2ecc71; box-shadow: 0 0 8px rgba(46,204,113,0.5); }
.status-dot.warning { background: var(--amber); }
.sos-btn { width: 100%; padding: 16px; background: var(--red); color: #fff; border: none; border-radius: 10px; font-family: var(--font); font-weight: 700; font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all .2s; margin-bottom: 10px; }
.sos-btn:hover { background: #c0392b; transform: scale(1.02); }
.call-btn { width: 100%; padding: 13px; background: var(--white); color: var(--red); border: 2px solid var(--red); border-radius: 10px; font-family: var(--font); font-weight: 600; font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all .2s; }
.call-btn:hover { background: #fdecea; }
.contacts-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 16px; }
.contact-card { background: var(--white); border-radius: var(--radius); border: 1px solid var(--border); padding: 18px; display: flex; align-items: center; gap: 14px; }
.contact-avatar { width: 46px; height: 46px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1rem; }
.contact-card h4 { font-size: 0.92rem; font-weight: 700; margin-bottom: 2px; }
.contact-card .role { font-size: 0.78rem; color: var(--text-light); margin-bottom: 5px; }
.contact-card a { color: var(--teal); font-size: 0.82rem; text-decoration: none; font-weight: 600; }
.add-contact { border: 2px dashed var(--border); background: var(--bg); justify-content: center; cursor: pointer; flex-direction: column; text-align: center; color: var(--text-light); transition: all .2s; }
.add-contact:hover { border-color: var(--teal); color: var(--teal); }
.add-contact svg { width: 22px; height: 22px; }

/* ===================== SUPPORT VIEW ===================== */
.support-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
.chat-window { height: 320px; background: var(--bg); border-radius: 10px; padding: 18px; overflow-y: auto; display: flex; flex-direction: column; gap: 14px; margin-bottom: 15px; }
.chat-bubble { max-width: 80%; padding: 10px 14px; border-radius: 12px; font-size: 0.88rem; line-height: 1.6; }
.chat-bubble.system { background: var(--white); border: 1px solid var(--border); color: var(--text); align-self: flex-start; border-bottom-left-radius: 4px; }
.chat-bubble.user { background: var(--teal); color: #fff; align-self: flex-end; border-bottom-right-radius: 4px; }
.chat-input-row { display: flex; gap: 10px; }
.chat-input-row input { flex: 1; padding: 11px 14px; border: 1.5px solid var(--border); border-radius: 8px; font-family: var(--font); font-size: 0.9rem; outline: none; }
.chat-input-row input:focus { border-color: var(--teal); }
.contact-list { display: flex; flex-direction: column; gap: 12px; }
.contact-info-item { display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--bg); border-radius: 8px; font-size: 0.88rem; }
.contact-info-item svg { color: var(--teal); flex-shrink: 0; }

/* ===================== FAQ VIEW ===================== */
.faq-list { max-width: 750px; display: flex; flex-direction: column; gap: 12px; }
.faq-item { background: var(--white); border-radius: var(--radius); border: 1px solid var(--border); overflow: hidden; }
.faq-q { padding: 18px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: 600; font-size: 0.95rem; }
.faq-q:hover { background: var(--bg); }
.faq-q svg { color: var(--teal); flex-shrink: 0; transition: transform .2s; }
.faq-a { padding: 0 20px; max-height: 0; overflow: hidden; font-size: 0.9rem; color: var(--text-light); line-height: 1.7; transition: max-height .3s, padding .3s; }
.faq-a.open { max-height: 200px; padding: 0 20px 18px; }
.faq-q.open svg { transform: rotate(180deg); }

/* ===================== RESOURCES VIEW ===================== */
.resources-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.resource-card { background: var(--white); border-radius: var(--radius); border: 1px solid var(--border); padding: 22px; }
.resource-card h3 { font-size: 1rem; font-weight: 700; margin-bottom: 10px; color: var(--text); }
.resource-card p, .resource-card li { font-size: 0.88rem; color: var(--text-light); line-height: 1.7; }
.resource-card ul { padding-left: 18px; margin-top: 8px; }
.resource-card li { margin-bottom: 4px; }
.resource-tag { display: inline-block; background: var(--teal-light); color: var(--teal-dark); padding: 3px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; margin-right: 6px; margin-bottom: 10px; }

/* ===================== NOTIFICATIONS ===================== */
.notif-popup { position: fixed; bottom: 30px; right: 30px; background: var(--white); border-radius: var(--radius); box-shadow: var(--shadow-lg); padding: 18px 22px; border-left: 4px solid var(--teal); max-width: 320px; z-index: 9999; transform: translateY(100px); opacity: 0; transition: all .4s; }
.notif-popup.show { transform: translateY(0); opacity: 1; }
.notif-popup.warn { border-color: var(--red); }
.notif-title { font-weight: 700; font-size: 0.9rem; margin-bottom: 4px; }
.notif-msg { font-size: 0.82rem; color: var(--text-light); }

/* Login error */
.login-error { background: #fdecea; color: #c0392b; border-radius: 8px; padding: 10px 14px; font-size: 0.85rem; font-weight: 600; margin-bottom: 14px; display: none; }
.login-error.show { display: block; }

/* Responsive */
@media(max-width:900px) {
  .stats-row { grid-template-columns: 1fr 1fr; }
  .feature-grid, .testimonial-grid, .contacts-grid { grid-template-columns: 1fr; }
  .land-nav { padding: 15px 20px; }
  .hero { padding: 50px 20px; }
  .login-right { display: none; }
  .sidebar { width: 60px; }
  .sb-link span, .sb-section-label, .sb-user-info, .sb-logo span { display: none; }
}

h2.view-title { font-family: var(--font-serif); font-size: 1.5rem; margin-bottom: 22px; color: var(--text); }
</style>
</head>
<body>

<!-- =================== LANDING PAGE =================== -->
<div id="landing" class="page active">
  <nav class="land-nav">
    <div class="land-logo"><i data-feather="activity"></i><span>FallVision</span></div>
    <div class="land-nav-links">
      <a href="#">Features</a>
      <a href="#">Guardians</a>
      <a href="#">Pricing</a>
      <a href="#">Support</a>
      <a href="#" class="btn btn-outline-teal" onclick="showPage('login')">Login</a>
    </div>
  </nav>

  <section class="hero">
    <div class="hero-content">
      <div class="hero-badge"><i data-feather="shield" style="width:12px;height:12px;"></i> AI-Powered Fall Prevention</div>
      <h1>Your Partner in Healthy Aging</h1>
      <p>Maintain independence, stay connected, and live fully with intelligent movement monitoring that keeps you and your loved ones safe.</p>
      <div class="hero-btns">
        <a href="#" class="btn btn-primary" onclick="showPage('login')">Get Started Free</a>
        <a href="#" class="btn btn-ghost">Watch Demo</a>
      </div>
      <div class="hero-stats">
        <div class="hero-stat"><strong>98%</strong><span>Detection accuracy</span></div>
        <div class="hero-stat"><strong>12k+</strong><span>Seniors protected</span></div>
        <div class="hero-stat"><strong>&lt;2s</strong><span>Alert response time</span></div>
      </div>
    </div>
  </section>

  <section class="features-section">
    <div class="section-label">How It Works</div>
    <div class="section-title">Intelligent Protection, Simply Done</div>
    <div class="feature-grid">
      <div class="feature-card">
        <div class="feat-icon"><i data-feather="eye"></i></div>
        <h3>Smart Vision Detection</h3>
        <p>AI-powered cameras analyze movement patterns in real-time, learning your unique gait and flagging anomalies before a fall occurs.</p>
      </div>
      <div class="feature-card">
        <div class="feat-icon"><i data-feather="bell"></i></div>
        <h3>Instant Guardian Alerts</h3>
        <p>Caregivers and family members receive immediate notifications via app, SMS, or call when a threshold alert is triggered.</p>
      </div>
      <div class="feature-card">
        <div class="feat-icon"><i data-feather="trending-up"></i></div>
        <h3>Health Trend Insights</h3>
        <p>Monthly mobility reports show movement quality scores, fall risk index, and personalized recommendations for your care team.</p>
      </div>
      <div class="feature-card">
        <div class="feat-icon"><i data-feather="lock"></i></div>
        <h3>Private & Encrypted</h3>
        <p>All video is processed locally on-device. Only anonymized motion data and alerts are transmitted ‚Äî never raw footage.</p>
      </div>
      <div class="feature-card">
        <div class="feat-icon"><i data-feather="phone-call"></i></div>
        <h3>Emergency Hub</h3>
        <p>One-tap SOS alerts, auto-dial emergency services, and a curated contact list of guardians and medical professionals.</p>
      </div>
      <div class="feature-card">
        <div class="feat-icon"><i data-feather="activity"></i></div>
        <h3>Brain-Body Correlation</h3>
        <p>Monitor the link between cognitive signals and limb movement ‚Äî an early indicator of neurological changes affecting balance.</p>
      </div>
    </div>
  </section>

  <section class="testimonials-section">
    <div class="section-label">Testimonials</div>
    <div class="section-title">Trusted by Families Everywhere</div>
    <div class="testimonial-grid">
      <div class="testimonial-card">
        <div class="testi-avatar">F</div>
        <div class="testi-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <p>"Truly amazing peace of mind. My mother had a near-fall incident and FallVision caught it before anyone else did. The guardian alert was in my phone within seconds."</p>
        <div class="testi-name">Fort En. Maly</div>
        <div class="testi-role">Daughter & Primary Guardian</div>
      </div>
      <div class="testimonial-card">
        <div class="testi-avatar">H</div>
        <div class="testi-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <p>"The best investment for my parents' safety. The trend reports are incredibly detailed and Dr. Smith uses them in every check-up now. It's changed how we approach care."</p>
        <div class="testi-name">Hemis En. Aigins</div>
        <div class="testi-role">Son & Healthcare Coordinator</div>
      </div>
      <div class="testimonial-card">
        <div class="testi-avatar">N</div>
        <div class="testi-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
        <p>"Easy to use and very reliable. Setup took under 20 minutes and the interface is clean. My father, who isn't tech-savvy at all, finds it completely unintrusive."</p>
        <div class="testi-name">Nowr Siro Soaad</div>
        <div class="testi-role">Care Manager</div>
      </div>
    </div>
  </section>

  <footer class="land-footer">
    <p>¬© 2025 <span>FallVision</span> ‚Äî All rights reserved. Empowering independence through intelligent care.</p>
  </footer>
</div>

<!-- =================== LOGIN PAGE =================== -->
<div id="login" class="page">
    <div class="login-left">
      <div class="login-form-wrap">
        <div class="login-logo"><i data-feather="activity"></i> FallVision</div>
        <p class="login-subtitle" id="login-subtitle">Sign in to your care dashboard</p>
        <div class="tab-row">
          <button class="tab-btn active" onclick="switchAuthTab('login',this)">Login</button>
          <button class="tab-btn" onclick="switchAuthTab('signup',this)">Sign Up</button>
        </div>

        <!-- Login error message -->
        <div class="login-error" id="login-error">Invalid email or password. Please try again.</div>

        <!-- Login Fields -->
        <div id="login-fields">
          <div class="form-field">
            <label>Email Address</label>
            <input type="email" id="login-email" placeholder="you@example.com">
          </div>
          <div class="form-field">
            <label>Password</label>
            <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <div class="form-field">
            <label>Quick PIN (Optional)</label>
            <input type="text" placeholder="4-digit PIN" maxlength="4">
          </div>
          <button class="btn btn-primary" style="width:100%;justify-content:center;margin-top:6px;padding:13px;" onclick="handleLogin()">Login to Dashboard</button>
          <div class="login-footer-row" style="margin-top:14px;">
            <a href="#">Forgot Password?</a>
            <a href="#" onclick="showPage('landing')">‚Üê Back to Home</a>
          </div>
        </div>

        <!-- Sign Up Fields -->
        <div id="signup-fields">
          <div class="form-field">
            <label>Full Name</label>
            <input type="text" id="signup-name" placeholder="e.g. Dr. Sarah Jones">
          </div>
          <div class="form-field">
            <label>Email Address</label>
            <input type="email" id="signup-email" placeholder="you@example.com">
          </div>
          <div class="form-field">
            <label>Role / Title</label>
            <input type="text" id="signup-role" placeholder="e.g. Senior Care Lead">
          </div>
          <div class="form-field">
            <label>Password</label>
            <input type="password" id="signup-password" placeholder="Create a password">
          </div>
          <button class="btn btn-primary" style="width:100%;justify-content:center;margin-top:6px;padding:13px;" onclick="handleSignup()">Create Account & Enter</button>
          <div class="login-footer-row" style="margin-top:14px;">
            <span></span>
            <a href="#" onclick="showPage('landing')">‚Üê Back to Home</a>
          </div>
        </div>

        <div class="secure-line"><i data-feather="shield" style="width:13px;height:13px;"></i> 256-bit Encrypted Connection</div>
      </div>
    </div>
    <div class="login-right">
      <div class="login-right-content">
        <h2>Your Partner in Healthy Aging. Rediscover Independence.</h2>
        <p>Trusted by over 12,000 seniors and their families. Real-time monitoring, instant alerts, and actionable health insights ‚Äî all in one place.</p>
      </div>
    </div>
</div>

<!-- =================== DASHBOARD =================== -->
<div id="dashboard" class="page">
  <aside class="sidebar">
    <div class="sb-logo"><i data-feather="activity"></i><span>FallVision</span></div>
    <div class="sb-section-label">MONITORING</div>
    <div class="sb-nav">
      <button class="sb-link active" onclick="showView('home',this)"><i data-feather="home"></i><span>Home</span></button>
      <button class="sb-link" onclick="showView('detection',this)"><i data-feather="eye"></i><span>Detection</span></button>
      <button class="sb-link" onclick="showView('records',this)"><i data-feather="file-text"></i><span>Past Records</span></button>
      <button class="sb-link" onclick="showView('trends',this)"><i data-feather="trending-up"></i><span>Trends</span></button>
    </div>
    <div class="sb-section-label">RESPONSE</div>
    <div class="sb-nav">
      <button class="sb-link" onclick="showView('emergency',this)"><i data-feather="alert-circle"></i><span>Emergency Hub</span></button>
    </div>
    <div class="sb-user">
      <div class="sb-avatar" id="sb-avatar">EV</div>
      <div class="sb-user-info">
        <strong id="sb-user-name">Dr Eleanor Vance</strong>
        <small id="sb-user-role">Senior Care Lead</small>
      </div>
    </div>
  </aside>

  <div class="dash-main">
    <!-- Top bar -->
    <div class="dash-topbar">
      <div class="topbar-title">Patient: Margaret Sullivan, 78</div>
      <div class="topbar-nav">
        <button class="topbar-link active" onclick="showView('home',null);setTopbarActive(this)"><i data-feather="home" style="width:14px;height:14px;"></i> Home</button>
        <button class="topbar-link" onclick="showView('support',null);setTopbarActive(this)"><i data-feather="message-square" style="width:14px;height:14px;"></i> Support</button>
        <button class="topbar-link" onclick="showView('faq',null);setTopbarActive(this)"><i data-feather="help-circle" style="width:14px;height:14px;"></i> FAQ</button>
        <button class="topbar-link" onclick="showView('resources',null);setTopbarActive(this)"><i data-feather="book-open" style="width:14px;height:14px;"></i> Resources</button>
      </div>
      <div class="topbar-right">
        <div class="topbar-badge"><div class="dot"></div> System Live</div>
        <button class="btn btn-primary" style="font-size:0.82rem;padding:8px 16px;" onclick="logout()">‚Üê Logout</button>
      </div>
    </div>

    <!-- Dashboard Content -->
    <div class="dash-content">

      <!-- HOME VIEW -->
      <div id="view-home" class="dash-view active">
        <div class="home-welcome">
          <h2 id="welcome-greeting">Good morning, Dr Vance üëã</h2>
          <p>Margaret's monitoring system is active. Last movement event logged at 9:14 AM. All thresholds within normal range.</p>
        </div>
        <div class="stats-row">
          <div class="stat-item">
            <div style="color:var(--teal);"><i data-feather="activity" style="width:18px;height:18px;"></i></div>
            <div class="value">92%</div>
            <div class="label">Mobility Score Today</div>
            <div class="change up"><i data-feather="arrow-up" style="width:11px;height:11px;"></i>+3% from yesterday</div>
          </div>
          <div class="stat-item">
            <div style="color:var(--amber);"><i data-feather="alert-triangle" style="width:18px;height:18px;"></i></div>
            <div class="value">Low</div>
            <div class="label">Fall Risk Index</div>
            <div class="change neutral">Stable ‚Äî 30 days</div>
          </div>
          <div class="stat-item">
            <div style="color:var(--red);"><i data-feather="zap" style="width:18px;height:18px;"></i></div>
            <div class="value">2</div>
            <div class="label">Alerts This Month</div>
            <div class="change down">Both resolved</div>
          </div>
          <div class="stat-item">
            <div style="color:var(--teal);"><i data-feather="battery" style="width:18px;height:18px;"></i></div>
            <div class="value">98%</div>
            <div class="label">Sensor Battery</div>
            <div class="change up">Fully operational</div>
          </div>
        </div>
        <div class="home-grid">
          <div>
            <div class="card" style="margin-bottom:18px;">
              <div class="card-title">Recent Activity Feed</div>
              <div class="card-subtitle" style="margin-bottom:14px;">Last 24 hours</div>
              <div style="display:flex;flex-direction:column;gap:0;">
                <div class="event-item">
                  <div class="event-dot" style="background:var(--teal);"></div>
                  <div><strong style="font-size:0.85rem;">9:14 AM</strong> ‚Äî Right leg movement within normal range (142¬∞). <span style="color:var(--text-light);font-size:0.82rem;">No alert triggered.</span></div>
                </div>
                <div class="event-item">
                  <div class="event-dot" style="background:var(--amber);"></div>
                  <div><strong style="font-size:0.85rem;">8:01 AM</strong> ‚Äî Morning gait analysis complete. Mobility score: 92/100. <span style="color:var(--text-light);font-size:0.82rem;">Slight reduction in left knee flex.</span></div>
                </div>
                <div class="event-item">
                  <div class="event-dot" style="background:var(--teal);"></div>
                  <div><strong style="font-size:0.85rem;">Yesterday 7:45 PM</strong> ‚Äî Guardian John D. acknowledged alert. Status resolved. <span style="color:var(--text-light);font-size:0.82rem;">Oct 25.</span></div>
                </div>
                <div class="event-item">
                  <div class="event-dot" style="background:var(--red);"></div>
                  <div><strong style="font-size:0.85rem;">Oct 25, 6:32 PM</strong> ‚Äî Threshold alert: Right knee angle 20% below baseline. <span style="color:var(--text-light);font-size:0.82rem;">Guardian notified.</span></div>
                </div>
              </div>
            </div>
          </div>
          <div class="brain-diagram">
            <div class="card-title" style="margin-bottom:4px;">Brain‚ÄìBody Signal Chain</div>
            <div class="card-subtitle" style="margin-bottom:0;">Real-time correlation</div>
            <div class="diagram-row">
              <div class="diag-node">
                <div class="diag-icon"><i data-feather="monitor"></i></div>
                <div class="diag-label">Brain Signal</div>
                <div class="diag-sub">Motor cortex</div>
              </div>
              <div class="diag-arrow">‚Üí</div>
              <div class="diag-node">
                <div class="diag-icon"><i data-feather="zap"></i></div>
                <div class="diag-label">Muscle Cmd</div>
                <div class="diag-sub">Neural pathway</div>
              </div>
              <div class="diag-arrow">‚Üí</div>
              <div class="diag-node">
                <div class="diag-icon"><i data-feather="user"></i></div>
                <div class="diag-label">Limb Move</div>
                <div class="diag-sub">Angular velocity</div>
              </div>
            </div>
            <div class="diag-note">Healthy signals ‚Üí Fluid movement & balance</div>
          </div>
        </div>
      </div>

      <!-- DETECTION VIEW -->
      <div id="view-detection" class="dash-view">
        <h2 class="view-title">Live Movement Detection</h2>
        <div class="limb-selector" style="margin-bottom:16px;">
          <button class="limb-btn active" id="limb-right" onclick="selectLimb('right-leg','Right Leg',145,'Within Average Range',92)"><i data-feather="arrow-right" style="width:14px;height:14px;"></i> Right Leg</button>
          <button class="limb-btn" id="limb-left" onclick="selectLimb('left-leg','Left Leg',138,'Slight Reduction Noted',84)"><i data-feather="arrow-left" style="width:14px;height:14px;"></i> Left Leg</button>
          <button class="limb-btn" id="limb-arms" onclick="selectLimb('arms','Arms (Both)',112,'Below Threshold - Watch',71)"><i data-feather="activity" style="width:14px;height:14px;"></i> Arms</button>
        </div>
        <div class="det-row">
          <div class="det-left">
            <div class="video-wrap">
              <img src="https://images.unsplash.com/photo-1551076805-e1869033e561?ixlib=rb-1.2.1&auto=format&fit=crop&w=1000&q=80" alt="Live Feed">
              <div class="video-overlay">
                <div class="vid-badge"><div class="live-dot"></div> LIVE FEED</div>
                <div class="vid-status"><i data-feather="check-circle" style="width:12px;height:12px;"></i> <span id="det-status-text">Normal</span></div>
                <div class="vid-angle">
                  <div class="big" id="det-angle">145¬∞</div>
                  <small id="det-range">Within Average Range</small>
                </div>
              </div>
            </div>
            <div class="card" style="padding:16px 20px;">
              <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;">
                <span class="card-title" id="det-limb-label">Right Leg ‚Äî Angular Analysis</span>
                <span class="badge badge-green" id="det-quality-badge">Good</span>
              </div>
              <p style="font-size:0.83rem;color:var(--text-light);line-height:1.6;">Real-time correlation between motor cortex signals and limb angular velocity. Monitoring for irregularities indicating pre-fall conditions. Sensor refresh rate: 30fps.</p>
            </div>
          </div>
          <div class="det-right">
            <div class="card" style="text-align:center;">
              <div class="card-title" style="text-align:left;margin-bottom:14px;">Movement Quality</div>
              <div class="quality-ring">
                <svg viewBox="0 0 100 100">
                  <circle class="ring-bg" cx="50" cy="50" r="45"/>
                  <circle class="ring-val" id="det-ring" cx="50" cy="50" r="45" style="stroke-dashoffset:25;"/>
                </svg>
                <div class="ring-label" id="det-score">92%</div>
              </div>
              <div id="det-limb-name" style="font-size:0.8rem;color:var(--text-light);">Right Leg (Last 30 Min)</div>
            </div>

            <div class="card">
              <div class="card-title" style="margin-bottom:12px;">Angle History (30 min)</div>
              <canvas id="detectionChart" height="120"></canvas>
            </div>

            <div class="card">
              <div class="card-title" style="margin-bottom:14px;display:flex;align-items:center;gap:6px;"><i data-feather="sliders" style="width:15px;height:15px;color:var(--teal);"></i> Threshold Settings</div>
              <div class="threshold-row">
                <span style="font-size:0.85rem;">Min. Angle Threshold 130¬∞</span>
                <div class="toggle" id="t1" onclick="this.classList.toggle('off')"></div>
              </div>
              <div class="threshold-row">
                <span style="font-size:0.85rem;">Audio Alert (Guardian)</span>
                <div class="toggle" id="t2" onclick="this.classList.toggle('off')"></div>
              </div>
              <div class="threshold-row">
                <span style="font-size:0.85rem;">SMS Notifications</span>
                <div class="toggle off" id="t3" onclick="this.classList.toggle('off')"></div>
              </div>
              <div class="threshold-row">
                <span style="font-size:0.85rem;">Auto-call on Fall</span>
                <div class="toggle off" id="t4" onclick="this.classList.toggle('off')"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RECORDS VIEW -->
      <div id="view-records" class="dash-view">
        <h2 class="view-title">Past Records & Event History</h2>
        <div class="records-header-row">
          <div class="filter-tabs">
            <button class="ftab active" onclick="filterRecords('all',this)">All Cases</button>
            <button class="ftab" onclick="filterRecords('alert',this)">Threshold Alerts</button>
            <button class="ftab" onclick="filterRecords('resolved',this)">Resolved</button>
            <button class="ftab" onclick="filterRecords('normal',this)">Normal</button>
          </div>
          <input type="date" class="date-input">
        </div>
        <table class="records-table" id="records-table">
          <thead>
            <tr>
              <th>Date & Time</th>
              <th>Limb Analysed</th>
              <th>Angle Recorded</th>
              <th>Threshold Met</th>
              <th>Status</th>
              <th>Guardian Action</th>
            </tr>
          </thead>
          <tbody id="records-tbody">
          </tbody>
        </table>
        <div class="records-footer-grid">
          <div class="info-card">
            <h4>‚ö†Ô∏è High-Risk Events</h4>
            <p>Patient's Right Knee Angle decreased by 20% below baseline on Oct 25. Left leg also showed reduced flex during morning gait on Nov 1. Review recommended with physiotherapist.</p>
          </div>
          <div class="info-card">
            <h4>‚úÖ Guardian Actions Taken</h4>
            <p>Oct 25 ‚Äî Guardian John D. called patient. Status resolved within 8 minutes.<br>Nov 1 ‚Äî Dr. Sarah Smith updated care plan. Physiotherapy session booked for Nov 7.</p>
          </div>
        </div>
      </div>

      <!-- TRENDS VIEW -->
      <div id="view-trends" class="dash-view">
        <div class="trends-controls">
          <h2 class="view-title" style="margin-bottom:0;">Trends Analysis</h2>
          <div class="time-selector">
            <button class="time-btn" onclick="setTimeRange('week',this)">Week</button>
            <button class="time-btn active" onclick="setTimeRange('month',this)">Month</button>
            <button class="time-btn" onclick="setTimeRange('year',this)">Year</button>
          </div>
        </div>
        <div class="trends-main-grid">
          <div class="card">
            <div class="card-title" style="margin-bottom:14px;">Activity & Anomaly Detection</div>
            <canvas id="mainTrendChart" height="220"></canvas>
          </div>
          <div style="display:flex;flex-direction:column;gap:16px;">
            <div class="card" style="flex:1;">
              <div class="metric-label">Average Mobility Score</div>
              <div class="big-metric">87<span style="font-size:1.2rem;">/100</span></div>
              <div class="metric-change"><span style="color:var(--teal);font-weight:700;">‚Üë +5%</span> from last month</div>
            </div>
            <div class="card" style="flex:1;">
              <div class="metric-label">Fall Risk Index</div>
              <div class="big-metric warn">Low</div>
              <div class="metric-change">Stable over 30 days</div>
            </div>
          </div>
        </div>
        <div class="trends-bottom-grid">
          <div class="card" style="text-align:center;">
            <div class="metric-label" style="text-align:left;">Pre-Fall Indicators</div>
            <div class="big-metric" style="font-size:2.5rem;">2</div>
            <div class="metric-change">Flagged this month. 0 resulted in falls.</div>
          </div>
          <div class="card" style="text-align:center;">
            <div class="metric-label" style="text-align:left;">Active Monitoring Days</div>
            <div class="big-metric" style="font-size:2.5rem;">28</div>
            <div class="metric-change">of 30 days this month</div>
          </div>
          <div class="card" style="text-align:center;">
            <div class="metric-label" style="text-align:left;">Guardian Responses</div>
            <div class="big-metric" style="font-size:2.5rem;">2/2</div>
            <div class="metric-change">100% response rate this month</div>
          </div>
        </div>
      </div>

      <!-- EMERGENCY VIEW -->
      <div id="view-emergency" class="dash-view">
        <h2 class="view-title">Emergency Hub</h2>
        <div class="emergency-grid" style="margin-bottom:20px;">
          <div class="card">
            <div class="card-title">System Status</div>
            <div class="status-indicator">
              <div class="status-dot online"></div>
              <strong style="font-size:1rem;">All Systems Operational</strong>
            </div>
            <p style="font-size:0.85rem;color:var(--text-light);margin-bottom:14px;">Monitoring active. Camera connected. Sensor battery at 98%.</p>
            <div style="display:flex;flex-direction:column;gap:8px;">
              <div style="display:flex;justify-content:space-between;font-size:0.85rem;padding:8px 12px;background:var(--bg);border-radius:8px;">
                <span>Camera Feed</span><span class="badge badge-green">Online</span>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:0.85rem;padding:8px 12px;background:var(--bg);border-radius:8px;">
                <span>Motion Sensor</span><span class="badge badge-green">Active</span>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:0.85rem;padding:8px 12px;background:var(--bg);border-radius:8px;">
                <span>Guardian App</span><span class="badge badge-green">Connected</span>
              </div>
              <div style="display:flex;justify-content:space-between;font-size:0.85rem;padding:8px 12px;background:var(--bg);border-radius:8px;">
                <span>Battery Level</span><span class="badge badge-green">98%</span>
              </div>
            </div>
          </div>
          <div class="card" style="border-top:4px solid var(--red);">
            <div class="card-title" style="color:var(--red);margin-bottom:16px;">Emergency Actions</div>
            <button class="sos-btn" onclick="triggerSOS()"><i data-feather="bell" style="width:16px;height:16px;"></i> Trigger SOS Alert</button>
            <button class="call-btn" onclick="triggerCall()"><i data-feather="phone" style="width:16px;height:16px;"></i> Call Emergency Services (911)</button>
            <p style="font-size:0.78rem;color:var(--text-light);margin-top:14px;line-height:1.6;">SOS alerts all registered guardians simultaneously. Emergency call connects to local emergency services. Use only in genuine emergencies.</p>
          </div>
        </div>
        <h3 style="font-family:var(--font-serif);font-size:1.2rem;margin-bottom:16px;">Emergency Contacts</h3>
        <div class="contacts-grid">
          <div class="contact-card">
            <div class="contact-avatar" style="background:#e0f7f4;color:var(--teal-dark);">JD</div>
            <div>
              <h4>John Doe</h4>
              <div class="role">Primary Guardian</div>
              <a href="#">+1 234 567 890</a>
            </div>
          </div>
          <div class="contact-card">
            <div class="contact-avatar" style="background:#fef9e7;color:#b7770d;">SS</div>
            <div>
              <h4>Dr. Sarah Smith</h4>
              <div class="role">Cardiologist</div>
              <a href="#">+1 987 654 321</a>
            </div>
          </div>
          <div class="contact-card">
            <div class="contact-avatar" style="background:#fdecea;color:#c0392b;">PT</div>
            <div>
              <h4>Dr. Peter Tang</h4>
              <div class="role">Physiotherapist</div>
              <a href="#">+1 555 012 345</a>
            </div>
          </div>
          <div class="contact-card add-contact" onclick="showNotif('Contact feature coming soon!','Add an emergency contact via the FallVision mobile app.')">
            <i data-feather="plus"></i>
            <p style="font-size:0.82rem;margin-top:8px;">Add Contact</p>
          </div>
        </div>
      </div>

      <!-- SUPPORT VIEW -->
      <div id="view-support" class="dash-view">
        <h2 class="view-title">Support Center</h2>
        <div class="support-grid">
          <div class="card">
            <div class="card-title" style="margin-bottom:4px;">Live Chat Support</div>
            <div class="card-subtitle" style="margin-bottom:14px;">Typically responds in under 2 minutes</div>
            <div class="chat-window" id="chat-window">
              <div class="chat-bubble system"><strong>FallVision Support:</strong> Welcome! How can we help you today? Ask about setup, alerts, billing, or anything else.</div>
            </div>
            <div class="chat-input-row">
              <input type="text" id="chat-input" placeholder="Type your message..." onkeydown="if(event.key==='Enter')sendChat()">
              <button class="btn btn-primary" onclick="sendChat()">Send</button>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:14px;">
            <div class="card">
              <div class="card-title" style="margin-bottom:14px;">Contact Us</div>
              <div class="contact-list">
                <div class="contact-info-item"><i data-feather="mail" style="width:15px;height:15px;"></i> support@fallvision.com</div>
                <div class="contact-info-item"><i data-feather="phone" style="width:15px;height:15px;"></i> +1-800-FALL-CARE</div>
                <div class="contact-info-item"><i data-feather="clock" style="width:15px;height:15px;"></i> Mon‚ÄìFri, 8AM‚Äì8PM EST</div>
              </div>
            </div>
            <div class="card">
              <div class="card-title" style="margin-bottom:10px;">Quick Help</div>
              <div style="display:flex;flex-direction:column;gap:8px;">
                <button class="btn btn-outline-teal" style="font-size:0.82rem;justify-content:flex-start;border-radius:8px;" onclick="showView('faq',null)"><i data-feather="help-circle" style="width:13px;height:13px;"></i> View FAQ</button>
                <button class="btn btn-outline-teal" style="font-size:0.82rem;justify-content:flex-start;border-radius:8px;"><i data-feather="book" style="width:13px;height:13px;"></i> User Manual (PDF)</button>
                <button class="btn btn-outline-teal" style="font-size:0.82rem;justify-content:flex-start;border-radius:8px;"><i data-feather="video" style="width:13px;height:13px;"></i> Video Tutorials</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- FAQ VIEW -->
      <div id="view-faq" class="dash-view">
        <h2 class="view-title">Frequently Asked Questions</h2>
        <div class="faq-list">
          <div class="faq-item">
            <div class="faq-q" onclick="toggleFaq(this)">How does the movement detection work? <i data-feather="chevron-down"></i></div>
            <div class="faq-a">FallVision uses computer vision and AI to analyze movement patterns in real-time from the camera feed. It establishes a personalized baseline for each patient and detects anomalies ‚Äî such as sudden drops in joint angle or gait irregularities ‚Äî that indicate pre-fall conditions.</div>
          </div>
          <div class="faq-item">
            <div class="faq-q" onclick="toggleFaq(this)">Is my data private and secure? <i data-feather="chevron-down"></i></div>
            <div class="faq-a">Yes. All video is processed locally on-device using edge AI. Raw footage is never transmitted. Only anonymized motion metrics and alert events are sent to guardians or the care team. All data is AES-256 encrypted both in transit and at rest.</div>
          </div>
          <div class="faq-item">
            <div class="faq-q" onclick="toggleFaq(this)">How do I add or remove a guardian? <i data-feather="chevron-down"></i></div>
            <div class="faq-a">Go to Emergency Hub ‚Üí Emergency Contacts ‚Üí Add Contact. Guardians receive an invite by email and must confirm before they can receive alerts. To remove a guardian, tap their card and select "Remove Guardian".</div>
          </div>
          <div class="faq-item">
            <div class="faq-q" onclick="toggleFaq(this)">How do I reset or recalibrate my sensor? <i data-feather="chevron-down"></i></div>
            <div class="faq-a">Go to Settings ‚Üí Devices ‚Üí Sensor Calibration. Follow the on-screen instructions (takes about 3 minutes). Alternatively, restart the FallVision app and the sensor will auto-calibrate on next startup. Contact support if calibration fails repeatedly.</div>
          </div>
          <div class="faq-item">
            <div class="faq-q" onclick="toggleFaq(this)">What do the alert thresholds mean? <i data-feather="chevron-down"></i></div>
            <div class="faq-a">Thresholds are minimum joint angles (in degrees) below which the system considers movement abnormal for the patient. For example, a 130¬∞ threshold for the right knee means any recorded angle below 130¬∞ triggers an alert. These are customizable per patient in the Detection settings panel.</div>
          </div>
          <div class="faq-item">
            <div class="faq-q" onclick="toggleFaq(this)">Can FallVision work at night or in low light? <i data-feather="chevron-down"></i></div>
            <div class="faq-a">Yes. The FallVision camera supports infrared night-vision mode, which activates automatically when ambient light drops below a set threshold. Night detection accuracy is approximately 94% ‚Äî slightly below the daytime 98% ‚Äî but still highly reliable for fall prevention.</div>
          </div>
        </div>
      </div>

      <!-- RESOURCES VIEW -->
      <div id="view-resources" class="dash-view">
        <h2 class="view-title">Resources & Health</h2>
        <div class="resources-grid">
          <div class="resource-card">
            <span class="resource-tag">About</span>
            <h3>About FallVision</h3>
            <p>FallVision is a medically-informed AI platform dedicated to ensuring safety and independence for seniors through advanced movement analysis. Founded by a team of geriatricians, physiotherapists, and AI engineers, FallVision serves over 12,000 patients across North America and Europe.</p>
          </div>
          <div class="resource-card">
            <span class="resource-tag">Neuroscience</span>
            <h3>Brain Activity & Movement</h3>
            <p>Healthy brain-body coordination is essential for safe movement. The motor cortex sends commands via neural pathways to muscles, controlling joint angles and balance. Deterioration in this signal chain ‚Äî due to aging, stroke, or neurological conditions ‚Äî is the primary precursor to falls.</p>
            <ul>
              <li>Complex motor tasks strengthen neural pathways</li>
              <li>Coordination drills improve proprioception</li>
              <li>Meditation reduces stress-related motor impairment</li>
            </ul>
          </div>
          <div class="resource-card">
            <span class="resource-tag">Nutrition</span>
            <h3>Diet for Brain & Bone Health</h3>
            <ul>
              <li><strong>Omega-3 Fatty Acids:</strong> Fatty fish, walnuts, flaxseeds ‚Äî support neural integrity.</li>
              <li><strong>Antioxidants:</strong> Blueberries, dark chocolate ‚Äî reduce oxidative stress in the brain.</li>
              <li><strong>Vitamin D & Calcium:</strong> Dairy, leafy greens ‚Äî critical for bone density and fall recovery.</li>
              <li><strong>Magnesium:</strong> Nuts, seeds, spinach ‚Äî supports muscle function and sleep quality.</li>
            </ul>
          </div>
          <div class="resource-card">
            <span class="resource-tag">Exercise</span>
            <h3>Recommended Exercise Program</h3>
            <p>For seniors at fall risk, a structured exercise program can reduce fall incidence by up to 23%. Recommended activities include:</p>
            <ul>
              <li>Tai chi ‚Äî balance and slow-control training</li>
              <li>Resistance bands ‚Äî leg strengthening without joint stress</li>
              <li>Chair yoga ‚Äî flexibility and core stability</li>
              <li>Walking programs ‚Äî with FallVision monitoring active</li>
            </ul>
          </div>
        </div>
      </div>

    </div><!-- /dash-content -->
  </div><!-- /dash-main -->
</div><!-- /dashboard -->

<!-- Notification popup -->
<div class="notif-popup" id="notif">
  <div class="notif-title" id="notif-title">Alert</div>
  <div class="notif-msg" id="notif-msg"></div>
</div>

<script>
// ===========================
// USER STATE
// ===========================
let currentUser = {
  name: '',
  email: '',
  role: '',
  initials: ''
};

// Registered accounts (signup persists in session)
const registeredUsers = [
  { email: 'eleanor.vance@hospital.org', password: 'password', name: 'Dr Eleanor Vance', role: 'Senior Care Lead' }
];

// ===========================
// AUTH TAB SWITCH
// ===========================
function switchAuthTab(tab, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('login-error').classList.remove('show');

  if (tab === 'login') {
    document.getElementById('login-fields').style.display = 'block';
    document.getElementById('signup-fields').style.display = 'none';
    document.getElementById('login-subtitle').textContent = 'Sign in to your care dashboard';
  } else {
    document.getElementById('login-fields').style.display = 'none';
    document.getElementById('signup-fields').style.display = 'block';
    document.getElementById('login-subtitle').textContent = 'Create your FallVision account';
  }
}

// ===========================
// LOGIN HANDLER
// ===========================
function handleLogin() {
  const email = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  const errEl = document.getElementById('login-error');

  if (!email || !password) {
    errEl.textContent = 'Please enter your email and password.';
    errEl.classList.add('show');
    return;
  }

  const found = registeredUsers.find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === password);

  if (!found) {
    errEl.textContent = 'Invalid email or password. Please try again.';
    errEl.classList.add('show');
    return;
  }

  errEl.classList.remove('show');
  loginAs(found);
}

// ===========================
// SIGNUP HANDLER
// ===========================
function handleSignup() {
  const name     = document.getElementById('signup-name').value.trim();
  const email    = document.getElementById('signup-email').value.trim();
  const role     = document.getElementById('signup-role').value.trim() || 'Care Professional';
  const password = document.getElementById('signup-password').value;
  const errEl    = document.getElementById('login-error');

  if (!name || !email || !password) {
    errEl.textContent = 'Please fill in your name, email, and password.';
    errEl.classList.add('show');
    return;
  }

  const exists = registeredUsers.find(u => u.email.toLowerCase() === email.toLowerCase());
  if (exists) {
    errEl.textContent = 'An account with this email already exists. Please log in.';
    errEl.classList.add('show');
    return;
  }

  const newUser = { email, password, name, role };
  registeredUsers.push(newUser);
  errEl.classList.remove('show');
  loginAs(newUser);
}

// ===========================
// LOGIN AS USER ‚Äî updates all dynamic fields
// ===========================
function loginAs(user) {
  currentUser = {
    name: user.name,
    email: user.email,
    role: user.role,
    initials: getInitials(user.name)
  };

  // Update sidebar avatar & name
  document.getElementById('sb-avatar').textContent = currentUser.initials;
  document.getElementById('sb-user-name').textContent = currentUser.name;
  document.getElementById('sb-user-role').textContent = currentUser.role;

  // Update welcome banner greeting
  const greeting = getGreeting();
  const shortName = getShortName(user.name);
  document.getElementById('welcome-greeting').textContent = `${greeting}, ${shortName} üëã`;

  showDashboard();
}

// ===========================
// HELPERS
// ===========================
function getInitials(fullName) {
  const parts = fullName.trim().split(/\s+/).filter(p => !['dr','mr','mrs','ms','prof'].includes(p.toLowerCase()));
  if (parts.length === 1) return parts[0][0].toUpperCase();
  return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
}

function getShortName(fullName) {
  // If starts with Dr/Mr/Mrs/Ms/Prof keep that + last name
  const honorifics = ['Dr.', 'Dr', 'Mr.', 'Mr', 'Mrs.', 'Mrs', 'Ms.', 'Ms', 'Prof.', 'Prof'];
  const parts = fullName.trim().split(/\s+/);
  if (honorifics.includes(parts[0])) {
    // e.g. "Dr Eleanor Vance" ‚Üí "Dr Vance"
    return parts[0].replace('.','') + ' ' + parts[parts.length - 1];
  }
  // Plain name ‚Üí first name only
  return parts[0];
}

function getGreeting() {
  const h = new Date().getHours();
  if (h < 12) return 'Good morning';
  if (h < 17) return 'Good afternoon';
  return 'Good evening';
}

// ===========================
// PAGE ROUTING
// ===========================
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  feather.replace();
}

function showDashboard() {
  showPage('dashboard');
  setTimeout(initCharts, 200);
  setTimeout(initDetectionChart, 200);
}

function logout() {
  // Clear login fields
  document.getElementById('login-email').value = '';
  document.getElementById('login-password').value = '';
  document.getElementById('login-error').classList.remove('show');
  // Reset to login tab
  switchAuthTab('login', document.querySelectorAll('.tab-btn')[0]);
  showPage('login');
}

// ===========================
// DASHBOARD VIEWS
// ===========================
function showView(name, btn) {
  document.querySelectorAll('.dash-view').forEach(v => v.classList.remove('active'));
  const view = document.getElementById('view-' + name);
  if (view) view.classList.add('active');

  document.querySelectorAll('.sb-link').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');

  feather.replace();
  if (name === 'trends') setTimeout(initCharts, 100);
  if (name === 'detection') setTimeout(initDetectionChart, 100);
}

function setTopbarActive(btn) {
  document.querySelectorAll('.topbar-link').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

// ===========================
// LIMB SELECTOR
// ===========================
const limbData = {
  'right-leg': { angle: '145¬∞', range: 'Within Average Range', score: 92, label: 'Right Leg', offset: 25, status: 'Normal', badge: 'badge-green', badgeText: 'Good' },
  'left-leg':  { angle: '138¬∞', range: 'Slight Reduction Noted', score: 84, label: 'Left Leg',  offset: 52, status: 'Watch',  badge: 'badge-amber', badgeText: 'Monitor' },
  'arms':      { angle: '112¬∞', range: 'Below Threshold ‚Äî Alert', score: 71, label: 'Arms (Both)', offset: 86, status: 'Alert!', badge: 'badge-red',   badgeText: 'Alert' },
};

function selectLimb(key) {
  const d = limbData[key];
  if (!d) return;

  document.querySelectorAll('.limb-btn').forEach(b => b.classList.remove('active'));
  const btnMap = { 'right-leg': 'limb-right', 'left-leg': 'limb-left', 'arms': 'limb-arms' };
  const btnEl = document.getElementById(btnMap[key]);
  if (btnEl) btnEl.classList.add('active');

  document.getElementById('det-angle').textContent = d.angle;
  document.getElementById('det-range').textContent = d.range;
  document.getElementById('det-score').textContent = d.score + '%';
  document.getElementById('det-limb-name').textContent = d.label + ' (Last 30 Min)';
  document.getElementById('det-limb-label').textContent = d.label + ' ‚Äî Angular Analysis';
  document.getElementById('det-status-text').textContent = d.status;
  document.getElementById('det-ring').style.strokeDashoffset = d.offset;
  const badge = document.getElementById('det-quality-badge');
  badge.className = 'badge ' + d.badge;
  badge.textContent = d.badgeText;
  initDetectionChart();
}

// Fix limb buttons' onclick to pass only key
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('limb-right').onclick = () => selectLimb('right-leg');
  document.getElementById('limb-left').onclick  = () => selectLimb('left-leg');
  document.getElementById('limb-arms').onclick  = () => selectLimb('arms');
});

// ===========================
// CHARTS
// ===========================
let trendChart, detChart;

function initCharts() {
  const ctx = document.getElementById('mainTrendChart');
  if (!ctx) return;
  if (trendChart) trendChart.destroy();
  trendChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Week 1','Week 2','Week 3','Week 4'],
      datasets: [{
        label: 'Mobility Score',
        data: [82, 85, 84, 87],
        borderColor: '#2A9D8F',
        backgroundColor: 'rgba(42,157,143,0.08)',
        tension: 0.4, fill: true, pointRadius: 5,
        pointBackgroundColor: '#2A9D8F',
      },{
        label: 'Fall Risk Threshold',
        data: [40,40,40,40],
        borderColor: '#e74c3c',
        borderDash: [6,4],
        pointRadius: 0, borderWidth: 1.5, fill: false,
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'top', labels: { font: { family: 'DM Sans' } } } },
      scales: {
        y: { beginAtZero: true, max: 100, grid: { color: '#eee' } },
        x: { grid: { display: false } }
      }
    }
  });
}

function initDetectionChart() {
  const ctx = document.getElementById('detectionChart');
  if (!ctx) return;
  if (detChart) detChart.destroy();
  const data = Array.from({length:10}, () => Math.floor(130 + Math.random()*20));
  detChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: Array.from({length:10}, (_,i) => (i*3)+'min'),
      datasets: [{
        label: 'Angle (¬∞)',
        data: data,
        borderColor: '#2A9D8F',
        backgroundColor: 'rgba(42,157,143,0.07)',
        tension: 0.4, fill: true, pointRadius: 3,
      },{
        label: 'Threshold',
        data: Array(10).fill(130),
        borderColor: '#e74c3c',
        borderDash: [4,3],
        pointRadius: 0, borderWidth: 1.5, fill: false,
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: {
        y: { min: 100, max: 180, grid: { color: '#eee' } },
        x: { grid: { display: false }, ticks: { font: { size: 10 } } }
      }
    }
  });
}

// ===========================
// TRENDS TIME RANGE
// ===========================
const timeData = {
  week:  { labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], data: [80,83,82,88,85,90,87] },
  month: { labels: ['Week 1','Week 2','Week 3','Week 4'], data: [82,85,84,87] },
  year:  { labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'], data: [75,78,80,82,84,83,85,84,87,86,88,87] },
};

function setTimeRange(range, btn) {
  document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  if (!trendChart) return;
  const d = timeData[range];
  trendChart.data.labels = d.labels;
  trendChart.data.datasets[0].data = d.data;
  trendChart.data.datasets[1].data = Array(d.data.length).fill(40);
  trendChart.update();
}

// ===========================
// RECORDS TABLE
// ===========================
const allRecords = [
  { date: 'Nov 5, 9:14 AM',  limb: 'Right Leg',  angle: '142¬∞', threshold: 'Met (130¬∞)', status: 'Normal',    guardian: 'No action needed',  statusClass: 'badge-green', guardClass: 'badge-blue' },
  { date: 'Nov 3, 8:01 AM',  limb: 'Left Leg',   angle: '127¬∞', threshold: 'Below (130¬∞)', status: 'Alert',   guardian: 'John D. ‚Äî Notified', statusClass: 'badge-red',   guardClass: 'badge-amber' },
  { date: 'Nov 1, 11:22 AM', limb: 'Arms',        angle: '115¬∞', threshold: 'Below (120¬∞)', status: 'Alert',   guardian: 'Dr. Smith ‚Äî Called', statusClass: 'badge-red',   guardClass: 'badge-amber' },
  { date: 'Oct 30, 7:40 PM', limb: 'Right Leg',  angle: '145¬∞', threshold: 'Met (130¬∞)', status: 'Normal',    guardian: 'No action needed',  statusClass: 'badge-green', guardClass: 'badge-blue' },
  { date: 'Oct 25, 6:32 PM', limb: 'Right Knee', angle: '104¬∞', threshold: 'Critical (<110¬∞)', status: 'High Risk', guardian: 'John D. ‚Äî Called', statusClass: 'badge-red', guardClass: 'badge-red' },
  { date: 'Oct 22, 10:05 AM',limb: 'Left Leg',   angle: '138¬∞', threshold: 'Met (130¬∞)', status: 'Normal',    guardian: 'No action needed',  statusClass: 'badge-green', guardClass: 'badge-blue' },
];

function filterRecords(filter, btn) {
  document.querySelectorAll('.ftab').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  let rows = allRecords;
  if (filter === 'alert')    rows = allRecords.filter(r => r.statusClass === 'badge-red');
  if (filter === 'resolved') rows = allRecords.filter(r => r.guardian.includes('Called') || r.guardian.includes('Notified'));
  if (filter === 'normal')   rows = allRecords.filter(r => r.status === 'Normal');
  renderRecords(rows);
}

function renderRecords(records) {
  const tbody = document.getElementById('records-tbody');
  tbody.innerHTML = records.map(r => `
    <tr>
      <td>${r.date}</td>
      <td>${r.limb}</td>
      <td><strong>${r.angle}</strong></td>
      <td>${r.threshold}</td>
      <td><span class="badge ${r.statusClass}">${r.status}</span></td>
      <td><span class="badge ${r.guardClass}">${r.guardian}</span></td>
    </tr>
  `).join('');
}

// ===========================
// FAQ ACCORDION
// ===========================
function toggleFaq(el) {
  const ans = el.nextElementSibling;
  el.classList.toggle('open');
  ans.classList.toggle('open');
  feather.replace();
}

// ===========================
// CHAT
// ===========================
const chatReplies = [
  "Thanks for reaching out! Let me look into that for you.",
  "That's a great question. FallVision's detection typically updates within 30 seconds of a movement event.",
  "I can help with that. Could you tell me which device model your sensor is?",
  "Your account is fully encrypted. No worries there ‚Äî you're completely safe.",
  "I've escalated this to our technical team. You should hear back within 24 hours.",
];

function sendChat() {
  const input = document.getElementById('chat-input');
  const msg = input.value.trim();
  if (!msg) return;
  const win = document.getElementById('chat-window');
  win.innerHTML += `<div class="chat-bubble user">${msg}</div>`;
  input.value = '';
  setTimeout(() => {
    const reply = chatReplies[Math.floor(Math.random() * chatReplies.length)];
    win.innerHTML += `<div class="chat-bubble system"><strong>Support Agent:</strong> ${reply}</div>`;
    win.scrollTop = win.scrollHeight;
  }, 800);
  win.scrollTop = win.scrollHeight;
}

// ===========================
// EMERGENCY ACTIONS
// ===========================
function triggerSOS() {
  showNotif('üö® SOS Alert Sent!', 'All guardians have been notified. John D. and Dr. Sarah Smith are being contacted.', true);
}
function triggerCall() {
  showNotif('üìû Calling Emergency Services', 'Connecting to 911... Stay calm and remain on the line.', true);
}

// ===========================
// NOTIFICATION POPUP
// ===========================
function showNotif(title, msg, warn=false) {
  const notif = document.getElementById('notif');
  document.getElementById('notif-title').textContent = title;
  document.getElementById('notif-msg').textContent = msg;
  notif.className = 'notif-popup show' + (warn ? ' warn' : '');
  setTimeout(() => notif.classList.remove('show'), 4000);
}

// ===========================
// INIT
// ===========================
window.onload = () => {
  feather.replace();
  renderRecords(allRecords);

  // Enter key on login
  document.getElementById('login-password').addEventListener('keydown', e => {
    if (e.key === 'Enter') handleLogin();
  });
  document.getElementById('login-email').addEventListener('keydown', e => {
    if (e.key === 'Enter') handleLogin();
  });

  // Topbar syncs with sidebar
  document.querySelectorAll('.sb-link').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.sb-link').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelectorAll('.topbar-link').forEach(b => b.classList.remove('active'));
    });
  });
};
</script>
</body>
</html>